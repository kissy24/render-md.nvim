# 修正方針：見出しとリストの表示バグ改善 (fix_header.md)

## 1. 現状のバグ分析
- **H2 が H1 と同じ表示**:
    - `init.lua` のデフォルト設定で `h1`, `h2`, `h3` のアイコンがすべて同じ（`󰉫 `）であるため。
- **文字潰れ (Header: 2文字, Bullet: 3文字)**:
    - `virt_text_pos = "overlay"` を使用しているが、仮想テキストの表示幅が元のマーカー幅より広いため、後続の文字を覆い隠している。
    - 例：`# ` (2文字分) を `"󰉫 "` (3文字分) で overlay すると、後ろの文字が1〜2文字隠れる。

## 2. 修正ステップ
### Step 1: アイコン設定の修正
- `init.lua` のデフォルトアイコンをレベルごとに変更する（例：H1: 󰉫, H2: 󰉬, H3: 󰉭）。

### Step 2: 表示ロジックの変更 (Anti-Crush)
- `overlay` の使用をやめ、`virt_text_pos = "inline"` を検討するか、あるいはマーカー部分のみを `conceal` し、アイコンを `virt_text` で安全に挿入する方式に切り替える。
- 具体的には、マーカー（`#` や `-`）を隠しつつ、その手前に仮想テキストを置くことで、本文の座標を一切ずらさずに装飾する。

### Step 3: 背景色適用範囲の厳密化
- 行全体の背景色（`hl_eol = true`）を適用する際、装飾を含めた正しい範囲を指定する。

## 3. 期待される結果
- H1, H2, H3 が異なるアイコンと色で表示される。
- ヘッダーやリストの後のテキストが1文字も欠けることなく表示される。
